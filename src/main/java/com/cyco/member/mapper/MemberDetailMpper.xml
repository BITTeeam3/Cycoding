<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.cyco.member.dao.MemberDao">
	
	<select id="getMyDetail" resultType="com.cyco.common.vo.MemberVo">
		
		select  m.MEMBER_ID, m.MEMBER_EMAIL, m.MEMBER_NICKNAME, m.MEMBER_NAME, m.MEMBER_PWD, m.MEMBER_PHONE, m.MEMBER_EMAIL, m.MEMBER_IMAGE, p.HAVE_POINT
			    from member m left join point p
			    on m.MEMBER_ID=p.MEMBER_ID
			    where member_email=#{useremail}
		
	</select>
	
	<update id="editPersnalInfo">
		
		update member set ${param1}=#{param2} where MEMBER_ID=#{param3}

	</update>
	
	<update id="editProfile">
	
		update member set MEMBER_IMAGE=#{param2} where MEMBER_EMAIL=#{param1}
	
	</update>
	
	
	
	<select id="getSkills" resultType="com.cyco.common.vo.SkillVo">
		
		select skill_name, skill_code, skill_enabled from skill where skill_enabled=1
		
	</select>
	
		
		<select id="getPreferSkills" resultType="com.cyco.member.vo.MemberDetailPageVo">
		
		select s.skill_name, s.skill_enabled from skill s left join m_skill ms
				on s.skill_code = ms.skill_code left join member m
				on ms.member_id = m.member_id
				 where s.skill_enabled=1 and m.member_email=#{userid}
				 order by ms_count
		
	</select>

	
	<select id="getPositions" resultType="com.cyco.common.vo.PositionVo">
		
		select position_name, position_id, position_enabled from position where position_enabled=1
		
	</select>
	
		
		<select id="getPreferPosition" resultType="com.cyco.member.vo.MemberDetailPageVo">
		
			select p.position_id, p.position_name, p.position_enabled from position p left join m_detail md
			    on p.position_id=md.position_id left join member m
			    on md.member_id=m.member_id
			    where m.member_email=#{userid}
		
	</select>
	
	
	
	<select id="getDurations" resultType="com.cyco.member.vo.V_Duration">
		
		select du_date from v_duration group by du_date
		
	</select>
	
	<select id="getPreferDurations" resultType="com.cyco.member.vo.MemberDetailPageVo">
		
		select d.du_date from v_duration d left join member m
			on d.m_id = m.member_id
			where m.member_email=#{userid}		
		
	</select>
	
	<select id="getExperiences" resultType="com.cyco.member.vo.M_ExperienceVo">
	
		select e.exp_title, e.ex_position, e.ex_skill, e.ex_duration, e.ex_content, e.ex_count from m_experience e left join member m
    		on e.member_id=m.member_id
    		where m.member_email=#{userid}
    		order by e.ex_count	
	
	</select>
	
	
	
	<select id="haveExperience" resultType="String">
	
		select md.P_EXPERIENCE from m_detail md left join member m
			on md.member_id=m.member_id
			where m.member_email=#{userid}
	
	</select>
	
	
	<delete id="deleteSkills">
	
		delete from m_skill where MEMBER_ID=${memberid}
	
	</delete>
	
	<insert id="insertSkills" parameterType="String">
	
		INSERT INTO m_skill (ms_count, member_id, skill_code)
	VALUES(
		(SELECT MAX(ms_count)+1 FROM m_skill where member_id=${param1}),
    	${param1},#{param2}	)

	
	</insert>
	
	<insert id="insertExperiences" parameterType="com.cyco.member.vo.M_ExperienceVo">
	
		insert into m_experience (MEMBER_ID,EXP_TITLE,EX_POSITION,EX_SKILL,EX_DURATION,EX_CONTENT,EX_COUNT) 
			values(${MEMBER_ID},#{EXP_TITLE},#{EX_POSITION},#{EX_SKILL},#{EX_DURATION},#{EX_CONTENT},(SELECT nvl(MAX(EX_COUNT),0)+1 FROM m_experience where MEMBER_ID=${MEMBER_ID}))
	
	</insert>
	
	<delete id="deleteExperience">
	
		delete m_experience where ex_count=${param1} and member_id=${param2}
	
	</delete>
	
		<update id="updatePosition">
	
		update m_detail set position_id=#{param2} where member_id=${param1}
	
	</update>
	
	
	<delete id="deleteDurations">
	
		delete from v_duration where M_ID=${param1}
	
	</delete>
	
	<insert id="insertDurations" parameterType="String">
	
		INSERT INTO m_duration (duration_id, member_id) values (#{param2},${param1})

	
	</insert>
	
	<update id="updateExperience">
	
		update m_detail set p_experience=${param2} where member_id=${param1}
	
	</update>
	
	
		<select id="getMemberDetail" resultType="com.cyco.common.vo.MemberVo">
		
		select member_email, member_nickname, MEMBER_IMAGE from member where member_id=${memberid}
		
	</select>
	
	<update id="updateDeleteDate">
	
		update m_detail set delete_count=sysdate where member_id=${quit_id}
	
	</update>

	
</mapper>